'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.TimeSelect = undefined;

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var TimeSelect = exports.TimeSelect = {
    id: 1011,
    caption: '定时',
    editText: '定时',
    originCaption: '定时',
    fieldType: 'boolean',
    width: 375,
    height: 52,
    cssFile: '../static/widgets/TimeSelect/style.css',
    icon: '../static/img/widgets/clock-icon.png',
    iconActive: '../static/img/widgets/clock-icon-active.png',
    scheme: ['caption', 'show', 'time', 'multi[0]', 'widgetStyle', 'tone'],
    grid: ['text', 'style', 'interactive', 'size', 'exterior', 'hierarchy'],
    widgetInfo: {
        dragStatus: {
            top: true,
            bottom: true,
            left: true,
            right: true,
            changeWidth: false,
            changeHeight: false
        }
    },
    prev: _react2.default.createClass({
        render: function render() {
            return _react2.default.createElement(
                'li',
                { className: 'widget widget-left' },
                _react2.default.createElement('img', _extends({}, this.props, { src: '../static/img/widgets/calendar.png', className: 'icon' })),
                _react2.default.createElement('img', _extends({}, this.props, { src: '../static/img/widgets/calendar-active.png', className: 'icon-active' })),
                _react2.default.createElement(
                    'span',
                    null,
                    '\u5B9A\u65F6'
                )
            );
        }
    }),
    dom: 'React.createClass({\n            swiperHeight:0,\n            swiperTop:0,\n            swiperDomStyle:0,\n            getInitialState: function(){\n                return {\n                    hourtime:0,\n                    minutetime:0,\n                    hourindex:0,\n                    hourarr:[],\n                    minuteindex:0,\n                    switchStatus:2,\n                    show:false,\n                    minutearr:[],\n                    hourShow:true,\n                    minShow:true,\n                };\n            },\n            componentDidMount: function() {\n                var _state = typeof __props !== \'undefined\' ? __props : \'\';\n                var wid = this.props.userWidgetID;\n                if(!_state.hiddenArray&&this.props.statusVisibility==2){\n                    AppActions.init(wid);\n                }\n                //\u521D\u59CB\u5316\u65F6\u95F4\u53EF\u9009\u503C\u6570\u7EC4\n                this.timearrInit(this.props);\n            },\n            timearrInit:function(next){\n                //\u8BBE\u7F6E\u65F6\u95F4\u53EF\u9009\u503C\u6570\u7EC4\n                var maxhour = parseInt(next.maxhour) || 23;\n                var minhour = parseInt(next.minhour) || 0;\n                var hourstep = parseInt(next.hourstep) || parseInt(this.props.hourstep) || 1;\n                var maxlength = parseInt((maxhour-minhour)/hourstep);\n                var hourarr = [];\n                if(next.hourarray && next.hourarray instanceof Array){\n                    hourarr = next.hourarray;\n                    this.setState({\n                        hourarr:hourarr,\n                        hourtime:minhour\n                    });\n                }else{\n                    for(var i = 0;i<=maxlength;i++){\n                        var value = minhour+i*hourstep;\n                        value = value<10?\'0\'+value:value+\'\';\n                        hourarr.push(value);\n                    }\n                    maxhour = maxhour<10?\'0\'+maxhour:maxhour;\n                    if(hourarr.indexOf(maxhour) == -1 && hourarr.indexOf(maxhour+\'\') == -1) hourarr.push(maxhour);\n                    this.setState({\n                        hourarr:hourarr,\n                        hourtime:minhour\n                    });\n                }\n                //\u8BBE\u7F6E\u9ED8\u8BA4\u5C0F\u65F6\n                if(next.defaulthour){\n                    var index = hourarr.indexOf(next.defaulthour);\n                    if(index!=-1){\n                        this.setState({\n                            hourtime: next.defaulthour,\n                            hourindex:index\n                        });\n                    }\n                }\n                var maxminute = 59;\n                var minminute = 0;\n                var minutestep = parseInt(next.minutestep) || parseInt(this.props.minutestep) || 1;\n                var maxlength2 = parseInt((maxminute-minminute)/minutestep);\n                var minutearr = [];\n                for(var j = 0;j<=maxlength2;j++){\n                    var value = minminute+j*minutestep;\n                    value = value<10?\'0\'+value:value+\'\';\n                    minutearr.push(value);\n                }\n                if(minutearr.indexOf(maxminute) == -1 && minutearr.indexOf(maxminute+\'\') == -1) minutearr.push(maxminute);\n                this.setState({\n                    minutearr:minutearr,\n                    minutetime:minminute\n                });\n                //\u8BBE\u7F6E\u9ED8\u8BA4\u5206\u949F\n                if(next.defaultminute){\n                    var mindex = minutearr.indexOf(next.defaultminute);\n                    if(mindex!=-1){\n                        this.setState({\n                            minutetime: next.defaultminute,\n                            minuteindex:mindex\n                        });\n                    }\n                }\n                if(next.userWidgetID && sessionStorage.getItem(next.userWidgetID)){\n                    var seesionValue = sessionStorage.getItem(next.userWidgetID);\n                    var sessionState = JSON.parse(seesionValue);\n                    this.setState(sessionState);\n                }\n            },\n            componentWillReceiveProps: function(next) {\n                //\u66F4\u65B0\u65F6\u95F4\u53EF\u9009\u503C\u6570\u7EC4\n                if(next.hourstep!=this.props.hourstep || next.minhour!=this.props.minhour\n                    || next.maxhour!=this.props.maxhour){\n                    this.timearrInit(next);\n                }\n            },\n            startrange:function(e){\n                //\u5F00\u59CB\u6ED1\u52A8\u65F6\u95F4\u523B\u5EA6 \u8BB0\u5F55\u521D\u59CB\u5750\u6807\u503C\n                e.stopPropagation();\n                e.preventDefault();\n                var yvalue = parseInt(e.touches[0].clientY);\n                this.setState({\n                    oldy: yvalue\n                });\n            },\n            moverange:function(e){\n                //\u6ED1\u52A8\u65F6\u95F4\u523B\u5EA6 \u5224\u65AD\u6ED1\u52A8\u7C7B\u578B\u5E76\u6539\u53D8\u523B\u5EA6\u6761\u7684top\u503C \u4EA7\u751F\u6ED1\u52A8\u89C6\u89C9\u6548\u679C\n                e.stopPropagation();\n                e.preventDefault();\n                var yvalue = parseInt(e.touches[0].clientY);\n                var oldy = parseInt(this.state.oldy);\n                var value = (yvalue-oldy)/1.72;\n                if(value>20) value=20;\n                if(value<-20) value=-20;\n                var type = e.target.getAttribute(\'data-type\');\n                if(type==\'hour\'){\n                    this.setState({\n                        newy: yvalue,\n                        hourtop:value\n                    });\n                }\n                if(type==\'minute\'){\n                    this.setState({\n                        newy: yvalue,\n                        minutetop:value\n                    });\n                }\n            },\n            endrange:function(e){\n                //\u6ED1\u52A8\u7ED3\u675F \u8BA1\u7B97\u6ED1\u52A8\u8303\u56F4 \u5FFD\u7565\u592A\u5C0F\u7684\u6ED1\u52A8(20\u5185) \u7136\u540E\u8C03\u6574\u9009\u4E2D\u503C\u5E76\u91CD\u7F6E\u65F6\u95F4\u523B\u5EA6\u6761\n                e.stopPropagation();\n                e.preventDefault();\n                var newy = parseInt(this.state.newy);//\u6ED1\u52A8\u7ED3\u675F\u65F6\u7684y\u503C\n                var oldy = parseInt(this.state.oldy);//\u6ED1\u52A8\u5F00\u59CB\u65F6\u7684y\u503C\n                var hour = parseInt(this.state.hourtime);//\u4E0A\u4E00\u6B21\u9009\u4E2D\u7684\u5C0F\u65F6\u503C\n                var hourarr = this.state.hourarr;//\u5C0F\u65F6\u53EF\u9009\u503C\u6570\u7EC4\n                var hourindex = parseInt(this.state.hourindex);//\u4E0A\u6B21\u9009\u4E2D\u7684\u5C0F\u65F6\u503C\u5BF9\u5E94\u6570\u7EC4\u4E2D\u7D22\u5F15\n                var minutearr = this.state.minutearr;//\u5206\u949F\u53EF\u9009\u503C\u6570\u7EC4\n                var minuteindex = parseInt(this.state.minuteindex);//\u4E0A\u6B21\u9009\u4E2D\u7684\u5206\u949F\u503C\u5BF9\u5E94\u6570\u7EC4\u7D22\u5F15\n                var minute = parseInt(this.state.minutetime);//\u4E0A\u6B21\u9009\u4E2D\u7684\u5206\u949F\u503C\n                var hourstep = parseInt(this.props.hourstep) || 1;//\u5C0F\u65F6\u7684\u95F4\u9694\n                var minutestep = parseInt(this.props.minutestep) || 1;//\u5206\u949F\u7684\u95F4\u9694\n                var maxhour = parseInt(this.props.maxhour) || 23;//\u8BBE\u7F6E\u7684\u6700\u5927\u5C0F\u65F6\u503C\n                var minhour = parseInt(this.props.minhour) || 0;//\u8BBE\u7F6E\u7684\u6700\u5C0F\u5C0F\u65F6\u503C\n                var type = e.target.getAttribute(\'data-type\');//\u6ED1\u52A8\u66F4\u6539\u7684\u7C7B\u578B\n                //\u5C0F\u65F6\u51CF\u5C0F\n                if(newy-oldy>20 && type==\'hour\'){\n                    var rangestep = parseInt((newy-oldy)/50)>0 ? parseInt((newy-oldy)/50) : 1;\n                    hourindex = hourindex-rangestep;\n                    hourindex = hourindex<0?0:hourindex;\n                    hour = hourarr[hourindex];\n                    this.setState({\n                        hourtime:hour,\n                        hourindex:hourindex,\n                        hourtop:0\n                    });\n                };\n                //\u5C0F\u65F6\u589E\u52A0\n                if(newy-oldy<-20 && type==\'hour\'){\n                    var rangestep = parseInt((oldy-newy)/50)>0 ? parseInt((oldy-newy)/50) : 1;\n                    hourindex = hourindex+rangestep;\n                    hourindex = (hourindex>=hourarr.length)?(hourarr.length-1):hourindex;\n                    hour = hourarr[hourindex];\n                    this.setState({\n                        hourtime:hour,\n                        hourindex:hourindex,\n                        hourtop:0\n                    });\n                };\n                //\u5206\u949F\u51CF\u5C0F\n                if(newy-oldy>20 && type==\'minute\'){\n                    var rangestep = parseInt((newy-oldy)/50)>0 ? parseInt((newy-oldy)/50) : 1;\n                    minuteindex = minuteindex-rangestep;\n                    minuteindex = minuteindex<0?0:minuteindex;\n                    minute = minutearr[minuteindex];\n                    this.setState({\n                        minutetime:minute,\n                        minuteindex:minuteindex,\n                        minutetop:0\n                    });\n                };\n                //\u5206\u949F\u589E\u52A0\n                if(newy-oldy<-20 && type==\'minute\'){\n                    var rangestep = parseInt((oldy-newy)/50)>0 ? parseInt((oldy-newy)/50) : 1;\n                    minuteindex = minuteindex+rangestep;\n                    minuteindex = (minuteindex>=minutearr.length)?(minutearr.length-1):minuteindex;\n                    minute = minutearr[minuteindex];\n                    this.setState({\n                        minutetime:minute,\n                        minuteindex:minuteindex,\n                        minutetop:0\n                    });\n                };\n                //\u91CD\u7F6E\u4E3A\u672A\u62D6\u52A8\u72B6\u6001\n                this.setState({\n                    hourtop:0,\n                    minutetop:0\n                });\n            },\n            componentDidUpdate:function(){\n                var sessionValue = JSON.stringify(this.state);\n                if(this.props.userWidgetID){\n                    sessionStorage.setItem(this.props.userWidgetID,sessionValue);\n                }\n            },\n            endDefault:function(e){\n                //\u963B\u6B62IOS\u4E0A\u5192\u6CE1\u89E6\u53D1iscroll\u4E8B\u4EF6\n                e.stopPropagation();\n                e.preventDefault();\n            },\n            cancelclock:function(e){\n                e.stopPropagation();\n                e.preventDefault();\n                //\u53D6\u6D88\u9009\u62E9\n                // var wid = this.props.userWidgetID;\n                // AppActions.init(wid);\n                var switchValue = 2;\n                var selectShow = false;\n                this.setState({\n                    switchStatus:switchValue,\n                    show:selectShow\n                });\n            },\n            submitclock:function(e){\n                var _this = this;\n                var arg={};\n                if(this.props.statusSet[0].hourField) arg[this.props.statusSet[0].hourField]=this.state.hourtime;\n                if(this.props.statusSet[0].minuteField) arg[this.props.statusSet[0].minuteField]=this.state.minutetime;\n                if(this.props.statusSet[0].hourField || this.props.statusSet[0].minuteField){\n                    AppActions.repaint(arg);\n                }\n                //\u786E\u8BA4\u63D0\u4EA4\u65F6\u95F4\n                if(this.props.eventSet instanceof Array && this.props.eventSet.length>=1){\n                    var userWidgetID = this.props.userWidgetID;\n                    this.props.eventSet.sort(function(a,b){return a.eventType-b.eventType;}).map(function(item,index){\n                        if (item.eventType==1) {\n                            item.hourValue = parseInt(this.state.hourtime);\n                            item.minuteValue = parseInt(this.state.minutetime);\n                            AppActions.submitTime(item);\n                        }\n                    }.bind(this));\n                    this.setState({\n                        show:false,\n                    });\n                }else{\n                    console.log(\'eventSet error\');\n                }\n            },\n            handleClick:function(e){\n                var swiperDom = document.querySelector(\'.swiper-wrapper\');\n                var swiperSlide = document.getElementsByClassName(\'swiper-slide\');\n                var swiperContain = document.getElementsByClassName(\'swiper-container\');\n                if(swiperSlide.length>0){\n                    this.swiperHeight = swiperContain[0].style.height;\n                    this.swiperTop = swiperContain[0].style.top;\n                    this.swiperDomStyle = swiperDom.style.transform;\n\n                    swiperDom.style.transform = "none";//swiper\u91CC\u9762\u7528\u4E86transform  \u5BFC\u81F4fixed\u5931\u6548\n                    swiperContain[0].style.height = document.body.scrollHeight+\'px\';\n                    swiperContain[0].style.top = "0";\n                    for(var i=0 ; i<swiperSlide.length;i++){\n                        swiperSlide[i].style.transform = "none";\n                        swiperSlide[i].className = swiperSlide[i].className + " swiper-no-swiping";\n                    }\n                } \n                var switchValue = this.state.switchStatus==1?2:1;\n                var selectShow = switchValue==1?true:false;\n                this.setState({\n                    switchStatus:switchValue,\n                    show:selectShow\n                });\n            },\n            render: function() {\n                var maxhour = parseInt(this.props.maxhour) || 23;\n                var minhour = parseInt(this.props.minhour) || 0;\n                var hourshow = typeof this.props.hourshow !== \'undefined\' && Boolean(this.props.hourshow)===false ? false : true;\n                var minuteshow = typeof this.props.minuteshow !== \'undefined\' && Boolean(this.props.minuteshow)===false ? false : true;\n                if(!hourshow && !minuteshow) hourshow = true;\n                var hourstep = parseInt(this.props.hourstep) || 1;\n                var minutestep = parseInt(this.props.minutestep) || 1;\n                var selecttitle = this.props.timeTitle || \'\u8BBE\u7F6E\u65F6\u95F4\';\n                var statusname = this.props.statusname || \'\';\n                var hour = this.state.hourtime || \'0\';\n                hour=parseInt(hour)>maxhour?maxhour:parseInt(hour);\n                hour=hour<minhour?minhour:hour;\n                var minute = this.state.minutetime || \'0\';\n                minute=parseInt(minute)>59?59:parseInt(minute);\n                minute=minute<0?0:minute;\n                var hourtop = this.state.hourtop || 0;\n                var minutetop = this.state.minutetop || 0;\n                var hourarr = this.state.hourarr;\n                var hourindex = parseInt(this.state.hourindex);\n                var minutearr = this.state.minutearr;\n                var minuteindex = parseInt(this.state.minuteindex);\n                var timeClass = this.state.switchStatus==1?\'time-on\':\'time-off\';\n                var show = this.state.show;\n                var hourstatus = 0,minutestatus = 0;\n                var swiperContain = document.getElementsByClassName(\'swiper-container\');\n                var _state = typeof __props !== \'undefined\' ? __props : \'\';\n                if(_state){//\u8FD9\u4E2A\u8BA1\u65F6\u7684\u6CA1\u6CD5\u6539 \u8BA1\u65F6\u5B8C\u6210\u6CA1\u6709\u6807\u8BC6,\u6839\u672C\u65E0\u6CD5\u5224\u65AD\n                    this.props.statusSet.map(function(item,index){\n                        if(item.hourField){\n                            hourstatus = _state[item.hourField] || 0;\n                            if(_state[item.hourField]){\n                                console.log("\u5C0F\u65F6")\n                            }\n                        }\n                        if(item.minuteField){\n                            minutestatus = _state[item.minuteField] || 0;\n                            if(_state[item.minuteField]){\n                                console.log("\u5206\u949F")\n                            }\n                        }\n                    });\n                }\n                if(!this.state.show){//\u653E\u5165\u9009\u9879\u5361\u65F6 \u53D7swiper transform\u5F71\u54CDbug\u4FEE\u590D\n                    var swiperContain = document.querySelector(\'.swiper-container\');\n                    var swiperSlide = document.getElementsByClassName(\'swiper-slide\');\n                    var swiperDom = document.querySelector(\'.swiper-wrapper\');\n                    if(swiperContain && this.swiperHeight) {\n                        swiperContain.style.height = this.swiperHeight;//swiper\u9AD8\u5EA6\u8FD8\u539F\n                        swiperContain.style.top = this.swiperTop;\n                        swiperDom.style.transform = this.swiperDomStyle;\n                        if(swiperSlide){\n                            for(var i=0 ; i<swiperSlide.length;i++){\n                                swiperSlide[i].className = swiperSlide[i].className.replace(" swiper-no-swiping","") ;\n                            }\n                        }\n                    }\n                }\n                var widgetInfo = this.props.widgetInfo || {};\n                var timeStyle = widgetInfo.timeStyle ? widgetInfo.timeStyle : 0;\n                var bgColor = null;\n                if(timeClass == \'time-on\'){\n                    bgColor = this.props.style.color;\n                }\n                return (\n                    <div>\n                    <div {...this.props}>\n                    <section className=\'timeInfo flex\'>\n                        <span className=\'flex-cell\'>{selecttitle||\'\u5B9A\u65F6\u9884\u7EA6\'}</span>\n                        <span className=\'flex-cell\'>\n                            <label>{this.state.switchStatus==1?hourstatus:\'\'}</label>\n                            <label>{this.state.switchStatus==1?\':\':\'\'}</label>\n                            <label>{this.state.switchStatus==1?minutestatus:\'\'}</label>\n                        </span>\n                        <span className=\'flex-cell\'>\n                            <div onTouchEnd={this.handleClick} className={"timeSwitch "+timeClass+" timeStyle"+timeStyle}>\n                            {timeStyle==0 ?\n                                <div className="time-normal">\n                                    <span className={timeClass} style={{background:bgColor,borderColor:bgColor}}>\n                                        <em></em>\n                                    </span>\n                                </div>\n                                :\n                                <div className="time-xi">\n                                    <span className={timeClass}>\n                                        <em  style={{background:bgColor,borderColor:bgColor}}></em>\n                                    </span>\n                                </div>\n                            }\n                            </div>\n                        </span>\n                    </section>\n                    </div>\n                    <section className={\'timeSelect \'+(show?\'timeSelect-up\':\'timeSelect-down\')} style={{display:show?\'block\':\'none\'}}>\n                        <section onTouchEnd={this.cancelclock}></section>\n                        <section className="timeselect" onTouchMove={this.endDefault}>\n                            <section className=\'selecttitle\'>\n                                <span className=\'title\'>{selecttitle}</span>\n                            </section>\n                            <section className=\'time\'>\n                                <section data-type=\'hour\' style={{width:minuteshow?\'50%\':\'100%\',display:hourshow?\'inline-block\':\'none\'}}\n                                    onTouchStart={this.startrange} onTouchMove={this.moverange}\n                                    onTouchEnd={this.endrange}  className=\'hour\'>\n                                </section>\n                                <section  data-type=\'minute\' style={{display:minuteshow?\'inline-block\':\'none\',width:hourshow?\'50%\':\'100%\',left:hourshow?\'50%\':\'0%\'}}\n                                    onTouchStart={this.startrange} onTouchMove={this.moverange}\n                                    onTouchEnd={this.endrange} className=\'minute\'>\n                                </section>\n                                <section className=\'timetext\'>\n                                    <span className=\'hour\' style={{left:minuteshow?33+\'%\':53+\'%\',display:hourshow?\'inline-block\':\'none\'}}>\u65F6</span>\n                                    <span className=\'minute\' style={{display:minuteshow?\'inline-block\':\'none\',left:hourshow?66+\'%\':53+\'%\'}}>\u5206</span>\n                                    <span className=\'status\'>{statusname}</span>\n                                </section>\n                                <section className=\'hourvalue flex-column\' style={{top:hourtop+\'%\',left:minuteshow?25+\'%\':45+\'%\',display:hourshow?\'\':\'none\'}}>\n                                    <span className={(hourindex-3)<0?\'line4\':\'line1\'}>{(hourindex-3)<0?\'\':hourarr[hourindex-3]}</span>\n                                    <span className={(hourindex-2)<0?\'line4\':\'line1\'}>{(hourindex-2)<0?\'\':hourarr[hourindex-2]}</span>\n                                    <span className={(hourindex-1)<0?\'line4\':\'line2\'}>{(hourindex-1)<0?\'\':hourarr[hourindex-1]}</span>\n                                    <span className=\'line3\'>{hourarr[hourindex]}</span>\n                                    <span className={(hourindex+1)>=hourarr.length?\'line4\':\'line2\'}>{(hourindex+1)>=hourarr.length?\'\':hourarr[hourindex+1]}</span>\n                                    <span className={(hourindex+2)>=hourarr.length?\'line4\':\'line1\'}>{(hourindex+2)>=hourarr.length?\'\':hourarr[hourindex+2]}</span>\n                                    <span className={(hourindex+3)>=hourarr.length?\'line4\':\'line1\'}>{(hourindex+3)>=hourarr.length?\'\':hourarr[hourindex+3]}</span>\n                                </section>\n                                <section  className=\'minutevalue flex-column\' style={{top:minutetop+\'%\',display:minuteshow?\'\':\'none\',left:hourshow?58+\'%\':45+\'%\'}}>\n                                    <span className={(minuteindex-3)<0?\'line4\':\'line1\'}>{(minuteindex-3)<0?\'\':minutearr[minuteindex-3]}</span>\n                                    <span className={(minuteindex-2)<0?\'line4\':\'line1\'}>{(minuteindex-2)<0?\'\':minutearr[minuteindex-2]}</span>\n                                    <span className={(minuteindex-1)<0?\'line4\':\'line2\'}>{(minuteindex-1)<0?\'\':minutearr[minuteindex-1]}</span>\n                                    <span className=\'line3\'>{minutearr[minuteindex]}</span>\n                                    <span className={(minuteindex+1)>=minutearr.length?\'line4\':\'line2\'}>{(minuteindex+1)>=minutearr.length?\'\':minutearr[minuteindex+1]}</span>\n                                    <span className={(minuteindex+2)>=minutearr.length?\'line4\':\'line1\'}>{(minuteindex+2)>=minutearr.length?\'\':minutearr[minuteindex+2]}</span>\n                                    <span className={(minuteindex+3)>=minutearr.length?\'line4\':\'line1\'}>{(minuteindex+3)>=minutearr.length?\'\':minutearr[minuteindex+3]}</span>\n                                </section>\n                            </section>\n                            <section className=\'selectbtn flex\'>\n                                <span className=\'flex-cell\' onTouchEnd={this.cancelclock}>\u53D6\u6D88</span>\n                                <span className=\'flex-cell\' onTouchEnd={this.submitclock}>\u786E\u5B9A</span>\n                            </section>\n                        </section>\n                    </section>\n                    </div>\n                );\n            }\n    })'
};